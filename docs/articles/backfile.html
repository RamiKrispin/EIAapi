<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with Large Dataset • EIAapi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with Large Dataset">
<meta property="og:description" content="EIAapi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EIAapi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/backfile.html">Working with Large Dataset</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction to the EIA API</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RamiKrispin/EIAapi/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with Large Dataset</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RamiKrispin/EIAapi/blob/HEAD/vignettes/backfile.Rmd" class="external-link"><code>vignettes/backfile.Rmd</code></a></small>
      <div class="hidden name"><code>backfile.Rmd</code></div>

    </div>

    
    
<p>One of the limitations of the EIA API is the 5000 observations limit
per call. This could be challenging if you are trying to pull hourly
time series, which is roughly 26280 observations per year. The
<code>eia_backfill</code> function solves this issue and removes the API
number of observations per call limit. On the backend, the function
splits the query into multiple sequential queries, pulls the data, and
returns an append object.</p>
<p>For example, let’s pull hourly generation of electricity by New York
Independent System Operator on sub-region West using the
<code>eia_backfill</code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RamiKrispin/EIAapi" class="external-link">EIAapi</a></span><span class="op">)</span>

 <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXlt</a></span><span class="op">(</span><span class="st">"2018-06-19T00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>
 <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">end</span>, <span class="st">"tzone"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"UTC"</span>
 <span class="va">offset</span> <span class="op">&lt;-</span> <span class="fl">5000</span>
 <span class="va">api_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"eia_key"</span><span class="op">)</span>
 <span class="va">api_path</span> <span class="op">&lt;-</span> <span class="st">"electricity/rto/region-sub-ba-data/data/"</span>

 <span class="va">facets</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="st">"NYIS"</span>,
               subba <span class="op">=</span> <span class="st">"ZONA"</span><span class="op">)</span>
 
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eia_backfill.html">eia_backfill</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">start</span>,
                end <span class="op">=</span> <span class="va">end</span>,
                offset <span class="op">=</span> <span class="va">offset</span>,
                api_key <span class="op">=</span> <span class="va">api_key</span>,
                api_path <span class="op">=</span> <span class="va">api_path</span>,
                facets <span class="op">=</span> <span class="va">facets</span><span class="op">)</span></code></pre></div>
<p>As you can see below, the return series has more than 45,000
observations:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt;                  time subba subba_name parent</span>
<span class="co">#&gt; 1 2018-06-19 05:00:00  ZONA       West   NYIS</span>
<span class="co">#&gt; 2 2018-06-19 06:00:00  ZONA       West   NYIS</span>
<span class="co">#&gt; 3 2018-06-19 07:00:00  ZONA       West   NYIS</span>
<span class="co">#&gt; 4 2018-06-19 08:00:00  ZONA       West   NYIS</span>
<span class="co">#&gt; 5 2018-06-19 09:00:00  ZONA       West   NYIS</span>
<span class="co">#&gt; 6 2018-06-19 10:00:00  ZONA       West   NYIS</span>
<span class="co">#&gt;                            parent_name value   value_units</span>
<span class="co">#&gt; 1 New York Independent System Operator  1848 megawatthours</span>
<span class="co">#&gt; 2 New York Independent System Operator  1754 megawatthours</span>
<span class="co">#&gt; 3 New York Independent System Operator  1699 megawatthours</span>
<span class="co">#&gt; 4 New York Independent System Operator  1650 megawatthours</span>
<span class="co">#&gt; 5 New York Independent System Operator  1640 megawatthours</span>
<span class="co">#&gt; 6 New York Independent System Operator  1673 megawatthours</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; [1] 45074</span>

<span class="va">at_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/pretty.html" class="external-link">pretty</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span>
 <span class="va">at_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.POSIXt.html" class="external-link">seq.POSIXt</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">start</span>,
                  to <span class="op">=</span> <span class="va">end</span>,
                  by <span class="op">=</span> <span class="st">"2 years"</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">time</span>, <span class="va">df</span><span class="op">$</span><span class="va">value</span>,
      col <span class="op">=</span> <span class="st">"#1f77b4"</span>,
      type <span class="op">=</span> <span class="st">"l"</span>,
      frame.plot <span class="op">=</span> <span class="cn">FALSE</span>,
      axes <span class="op">=</span> <span class="cn">FALSE</span>,
      panel.first <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">at_y</span>, col <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span>,
      main <span class="op">=</span> <span class="st">"NY Independent System Operator (West) - Hourly Generation of Electricity"</span>,
      xlab <span class="op">=</span> <span class="st">"Source: https://www.eia.gov/"</span>,
      ylab <span class="op">=</span> <span class="st">"MegaWatt/Hours"</span><span class="op">)</span>

 <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side <span class="op">=</span><span class="fl">1</span>, text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">at_x</span>, format <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span>, at <span class="op">=</span> <span class="va">at_x</span>,
       col <span class="op">=</span> <span class="st">"grey20"</span>, line <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

 <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side <span class="op">=</span><span class="fl">2</span>, text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">at_y</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, at <span class="op">=</span> <span class="va">at_y</span>,
       col <span class="op">=</span> <span class="st">"grey20"</span>, line <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="backfile_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rami Krispin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
